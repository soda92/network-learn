= 网络协议分析复习: TCP

== TCP连接的建立

. 客户端发送SYN报文给服务器, 序号为i
. 服务器收到后, 发送SYN报文给客户端, 序号为j, 确认号为i+1
. 客户端收到后, 发送ACK报文, 序号为i+1, 确认号为j+1
. 服务端收到后, 连接建立

== TCP连接的关闭

. 客户端发送FIN报文给服务器, 序号为m
. 服务器收到后, 发送ACK报文给客户端, 序号为n, 确认号为m+1
. 此时双方可以继续发送数据, 假设发送完后客户端序号为m, 服务器序号为w-1
. 服务器发送FIN报文, 序号为w, 确认号为m+1
. 客户端收到后回复ACK报文, 序号为m+1, 确认号为w+1
. 客户端等待2MSL后关闭, 服务器收到lastack后关闭.

异常关闭

一方发送RST, 此时双方立即关闭连接

== TCP确认机制的特点

. TCP的确认序号指明的是期望收到的下一个报文段的序号
. 累计确认. TCP的确认信息会报告已经积累了多少个字节的数据流
. 捎带确认. 一方通常不单独发送确认, 而是把确认信息放到发给对方的数据中.

== SWS的起因和避免策略

起因::
接收方的小窗口通告造成发送方发送一系列小的报文段.

接收方的避免策略::
接收方在缓冲区满后, 等到缓冲区可用空间达到总空间的一半后才发送新的窗口通告, 此外, 在窗口大小不足以达到特定的限度时推迟发送确认.

发送方的避免策略::
避免发送小报文段. 等到数据长度达到MSS后才发送.

== TCP时间戳选项中tsrecent的取值

. 当包含lastack的报文到达时, 其中的时间戳被保存至tsrecent.
. 无论何时发送确认, tsrecent都被写入时间戳回显应答字段, 确认序号则被保存至lsatack.


