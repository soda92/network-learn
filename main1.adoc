= 网络协议分析复习: PPP和ARP

== TCP/IP分层模型中的两个边界

. 操作系统边界
. 协议地址边界

== 点到点和端到端通信

点到点指对等实体间的通信由一段段直接相连的机器间的通信组成，“端到端”则指对等实体间的通信像拥有一条直接线路。

[NOTE]
点到点针对终端节点，端到端针对应用进程。

== PPP协议的流程

. 为了建立一个PPP连接，双方必须发送LCP数据报来配置和测试数据链路。当连接建立后，双方可以要求使用PAP或CHAP认证身份。

. 双方必须通过NCP包来选择和配置一个或多个网络层协议。当所有的网络层协议都被配置后，这些协议的数据报可以被发送。

. 链路会一直保持开启，直到一方使用LCP或NCP包关闭连接，或一些外部事件发生（活跃计时器过期或网络管理员的干预）。

== LCP（链路控制协议）配置字段类型及作用

. MRU
. 认证协议
. 质量协议
. 幻数
. PFC
. ACFC

MRU:: 通告最大接受单元
认证协议:: 用于认证, 有PAP和CHAP两种, 可选
质量协议:: 用于检测数据丢失
幻数:: 用于防止环路
PFC:: 用于协商协议字段压缩
ACFC:: 用于协商地址和控制字段的压缩

== PAP认证协议

被认证方向认证方发送账号和密码来认证身份.

== CHAP认证协议

认证方向被认证方发送一个随机数, 被认证方使用密码计算散列值, 发给验证方来验证身份.

== TCP/IP的网络字节顺序

在低地址区域存放数据的低字节成为小端点机, 存放高字节称为大端点机. TCP/IP规定首先发送数据的高字节.

== 跨网转发数据报时ARP的使用和数据帧传输步骤

. 假设发送方为A, 接收方为B, 中间路由器为R
. A首先利用ARP获取R接收端口的MAC地址, 将此MAC设置为物理帧目的MAC地址, 源MAC设置为自己的MAC地址, 然后发送给R的接收端口
. R利用ARP获取B的MAC地址, 然后将物理帧的源MAC地址设置为自己与B相连接口的MAC地址, 目的MAC设为B的MAC, 然后将数据发送给B.
. 核心思想: 转发前利用ARP获取下一跳接口的物理地址.

== ARP报文格式及封装

ARP报文由以下字段组成:

* 硬件类型
* 上层协议类型
* MAC地址长度
* IP地址长度
* 操作类型
* 源MAC地址
* 源IP地址
* 目的MAC地址
* 目的IP地址

ARP报文前封装以太网帧头:

* 目的MAC地址
* 源MAC地址
* 帧类型

